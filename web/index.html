<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HMRC v2 — Quick Calculator</title>
  <link rel="stylesheet" href="/web/style.css" />
</head>
<body>
  <div class="container">
    <h1>HMRC v2 — Input & Validation Page</h1>
    <p class="hint">Sections: user inputs and computed fields marked with [C]. Calculations auto-refresh as you type. Accounting periods over 12 months are automatically split per HMRC rules.</p>

    <form id="dataForm">
      <div class="layoutRow rowMain">
        <div class="layoutCol">
          <section class="card" id="section1Card">
            <h2>Section 1</h2>
            <label>Start date of Accounting Period
              <input type="date" id="apStart" required />
            </label>
            <label>End date of Accounting Period
              <input type="date" id="apEnd" required />
            </label>
            <label>Number of associated companies
              <input type="number" id="assocCompanies" min="0" value="0" />
            </label>
          </section>
        </div>

        <div class="layoutCol">
          <section class="card" id="section2Card">
            <h2>Section 2: Trade</h2>

            <details class="dropGroup" open>
              <summary>
                <span>Trading income [C]</span>
                <input type="text" id="outTradingIncomeTotal" readonly data-key="outTradingIncomeTotal" />
              </summary>
              <div class="dropBody">
                <label>Turnover
                  <input type="number" id="turnover" step="0.01" value="0" />
                </label>
                <label>Government grants & subsidies
                  <input type="number" id="govtGrants" step="0.01" value="0" />
                </label>
              </div>
            </details>

            <details class="dropGroup" open>
              <summary>
                <span>Trading expenses [C]</span>
                <input type="text" id="outTradingExpenseTotal" readonly data-key="outTradingExpenseTotal" />
              </summary>
              <div class="dropBody">
                <label>Raw Materials & Consumables
                  <input type="number" id="rawMaterials" step="0.01" value="0" />
                </label>
                <label>Staff cost
                  <input type="number" id="staffCosts" step="0.01" value="0" />
                </label>
                <label>Depreciation
                  <input type="number" id="depreciation" step="0.01" value="0" />
                </label>
                <label>Other charges
                  <input type="number" id="otherCharges" step="0.01" value="0" />
                </label>
              </div>
            </details>

            <div class="mainInput">
              <h3>Add back: Disallowable expenses</h3>
              <input type="number" id="disallowableExpenses" step="0.01" value="0" />
            </div>

            <div class="mainInput">
              <h3>Other adjustments (add if positive, deduct if negative)</h3>
              <input type="number" id="otherAdjustments" step="0.01" value="0" />
            </div>

            <div class="mainInput">
              <h3>Less: AIA (trade)</h3>
              <input type="number" id="aiaTrade" step="0.01" value="0" />
            </div>

            <div class="calcHeaderRow">
              <span>Trading losses brought forward</span>
              <button type="button" class="calcIcon" data-calc-target="outTradingLossBFAvailable" data-calc-title="Trading losses brought forward">[C]</button>
            </div>
            <div class="mainInput">
              <h3>Trading losses to use this return</h3>
              <input type="number" id="tradingLossUseRequested" step="0.01" placeholder="Leave blank to auto-use available" />
            </div>

            <label class="computed mainComputed">Trading profits [C]
              <input type="text" id="outTradingProfits" readonly data-key="outTradingProfits" />
            </label>
            <label class="computed mainComputed">Trading profits subjected to corporation tax [C]
              <input type="text" id="outTradingProfitsTaxable" readonly data-key="outTradingProfitsTaxable" />
            </label>
          </section>
        </div>

        <div class="layoutCol">
          <section class="card" id="section3Card">
            <h2>Section 3</h2>
            <div class="mainInput">
              <h3>Interest income</h3>
              <input type="number" id="interestIncome" step="0.01" value="0" />
            </div>

            <div class="mainInput">
              <h3>Chargeable gains</h3>
              <input type="number" id="chargeableGains" step="0.01" value="0" />
              <label class="compactLabel">Upload attachment for calculation support
                <input type="file" id="chargeableGainsFile" accept=".xlsx,.xls,.csv,.xlsm" />
              </label>
            </div>

            <details class="dropGroup" open>
              <summary>
                <span>Rental & property income [C]</span>
                <input type="text" id="outRentalPropertyTotal" readonly data-key="outRentalPropertyTotal" />
              </summary>
              <div class="dropBody">
                <label>Rental & property income
                  <input type="number" id="rentalIncome" step="0.01" value="0" />
                </label>
                <label>Less: AIA (rental & property)
                  <input type="number" id="aiaNonTrade" step="0.01" value="0" />
                </label>
              </div>
            </details>

            <div class="calcHeaderRow">
              <span>Rental & property losses brought forward</span>
              <button type="button" class="calcIcon" data-calc-target="outPropertyLossBFAvailable" data-calc-title="Rental & property losses brought forward">[C]</button>
            </div>

            <div class="mainInput">
              <h3>Dividend income (not subjected to income tax)</h3>
              <input type="number" id="dividendIncome" step="0.01" value="0" />
            </div>

            <label class="computed mainComputed">Non-Trading profits [C]
              <input type="text" id="outNonTradingProfits" readonly data-key="outNonTradingProfits" />
            </label>
            <label class="computed mainComputed">Non-Trading profits subjected to corporation tax [C]
              <input type="text" id="outNonTradingProfitsTaxable" readonly data-key="outNonTradingProfitsTaxable" />
            </label>
          </section>
        </div>

        <div class="layoutCol">
          <section class="card" id="section4Card">
            <h2>Section 4: Tax Calculation</h2>
            <details class="dropGroup" open>
              <summary>
                <span>Total profits subjected to corporation tax [C]</span>
                <input type="text" id="ttProfitsChargeable" readonly data-key="ttProfitsChargeable" />
              </summary>
              <div class="dropBody">
                <label class="computed">Trade [C]
                  <input type="text" id="outTotalProfitsCTTrade" readonly data-key="outTotalProfitsCTTrade" />
                </label>
                <label class="computed">Non-trade [C]
                  <input type="text" id="outTotalProfitsCTNonTrade" readonly data-key="outTotalProfitsCTNonTrade" />
                </label>
              </div>
            </details>
            <label class="computed mainComputed">Tax payable [C]
              <input type="text" id="corpTaxPayable" readonly data-key="corpTaxPayable" />
            </label>
          </section>
        </div>

        <div class="layoutCol">
          <section class="card" id="section5Card">
            <h2>Section 5: Tax Variables</h2>

            <div class="varsGroup">
              <h3>Core Thresholds And Rates</h3>
              <div class="varsGrid">
                <label class="computed">AP days [C]
                  <input type="text" id="outApDays" readonly data-key="outApDays" />
                </label>
                <label class="computed">Associates divisor [C]
                  <input type="text" id="outAssocDivisor" readonly data-key="outAssocDivisor" />
                </label>
                <label class="computed">Lower bracket limit [C]
                  <input type="text" id="outLowerBracket" readonly data-key="outLowerBracket" />
                </label>
                <label class="computed">Lower tax rate [C]
                  <input type="text" id="outLowerRate" readonly data-key="outLowerRate" />
                </label>
                <label class="computed">Higher bracket limit [C]
                  <input type="text" id="outUpperBracket" readonly data-key="outUpperBracket" />
                </label>
                <label class="computed">Higher tax rate [C]
                  <input type="text" id="outUpperRate" readonly data-key="outUpperRate" />
                </label>
              </div>
            </div>

            <div class="varsGroup">
              <h3>Period 1 Breakdown</h3>
              <div class="varsGrid">
                <label class="computed">P1 revenue share [C]
                  <input type="text" id="outP1RevenueShare" readonly data-key="outP1RevenueShare" />
                </label>
                <label class="computed">P1 profit before tax [C]
                  <input type="text" id="outP1ProfitBeforeTax" readonly data-key="outP1ProfitBeforeTax" />
                </label>
                <label class="computed">P1 lower bracket limit [C]
                  <input type="text" id="outP1LowerBracket" readonly data-key="outP1LowerBracket" />
                </label>
                <label class="computed">P1 upper bracket limit [C]
                  <input type="text" id="outP1UpperBracket" readonly data-key="outP1UpperBracket" />
                </label>
                <label class="computed">P1 taxable profit [C]
                  <input type="text" id="outP1TaxableProfit" readonly data-key="outP1TaxableProfit" />
                </label>
                <label class="computed">P1 AIA claimed [C]
                  <input type="text" id="outP1AIAClaimed" readonly data-key="outP1AIAClaimed" />
                </label>
                <label class="computed">P1 marginal relief [C]
                  <input type="text" id="outP1MarginalRelief" readonly data-key="outP1MarginalRelief" />
                </label>
              </div>
            </div>

            <div class="varsGroup">
              <h3>Period 2 Breakdown</h3>
              <div class="varsGrid">
                <label class="computed">P2 revenue share [C]
                  <input type="text" id="outP2RevenueShare" readonly data-key="outP2RevenueShare" />
                </label>
                <label class="computed">P2 profit before tax [C]
                  <input type="text" id="outP2ProfitBeforeTax" readonly data-key="outP2ProfitBeforeTax" />
                </label>
                <label class="computed">P2 lower bracket limit [C]
                  <input type="text" id="outP2LowerBracket" readonly data-key="outP2LowerBracket" />
                </label>
                <label class="computed">P2 upper bracket limit [C]
                  <input type="text" id="outP2UpperBracket" readonly data-key="outP2UpperBracket" />
                </label>
                <label class="computed">P2 taxable profit [C]
                  <input type="text" id="outP2TaxableProfit" readonly data-key="outP2TaxableProfit" />
                </label>
                <label class="computed">P2 AIA claimed [C]
                  <input type="text" id="outP2AIAClaimed" readonly data-key="outP2AIAClaimed" />
                </label>
                <label class="computed">P2 marginal relief [C]
                  <input type="text" id="outP2MarginalRelief" readonly data-key="outP2MarginalRelief" />
                </label>
              </div>
            </div>

            <div class="varsGroup">
              <h3>Overall CT Drivers</h3>
              <div class="varsGrid">
                <label class="computed">Profits chargeable to corporation tax [C]
                  <input type="text" id="outTTPVar" readonly data-key="outTTPVar" />
                </label>
                <label class="computed">Augmented profits [C]
                  <input type="text" id="outAugmentedProfitsVar" readonly data-key="outAugmentedProfitsVar" />
                </label>
                <label class="computed">Total AIA claimed [C]
                  <input type="text" id="outTotalAIAClaimedVar" readonly data-key="outTotalAIAClaimedVar" />
                </label>
                <label class="computed">Total marginal relief [C]
                  <input type="text" id="outTotalMarginalReliefVar" readonly data-key="outTotalMarginalReliefVar" />
                </label>
              </div>
            </div>
          </section>
        </div>
      </div>

      <div class="techHidden" aria-hidden="true">
        <input type="hidden" id="tradingLossBF" value="0" />
        <input type="hidden" id="rentalLossBF" value="0" />
        <input type="hidden" id="outTradingLossBFAvailable" data-key="outTradingLossBFAvailable" />
        <input type="hidden" id="outPropertyLossBFAvailable" data-key="outPropertyLossBFAvailable" />
        <input type="hidden" id="outChargeableGainsTotal" data-key="outChargeableGainsTotal" />
        <input type="hidden" id="outTradingLossUsed" data-key="outTradingLossUsed" />
        <input type="hidden" id="totalIncome" data-key="totalIncome" />
        <input type="hidden" id="totalExpenses" data-key="totalExpenses" />
        <input type="hidden" id="tradingProfitBeforeTax" data-key="tradingProfitBeforeTax" />
        <input type="hidden" id="addbackDepreciation" data-key="addbackDepreciation" />
        <input type="hidden" id="netTradingProfits" data-key="netTradingProfits" />
        <input type="hidden" id="outGovtGrants" data-key="outGovtGrants" />
        <input type="hidden" id="outInterestIncome" data-key="outInterestIncome" />
        <input type="hidden" id="outDividendIncome" data-key="outDividendIncome" />
        <input type="hidden" id="outDisposalGains" data-key="outDisposalGains" />
        <input type="hidden" id="outCapitalGains" data-key="outCapitalGains" />
        <input type="hidden" id="outRentalIncome" data-key="outRentalIncome" />
        <input type="hidden" id="netRentalIncome" data-key="netRentalIncome" />
        <input type="hidden" id="profitBeforeTax" data-key="profitBeforeTax" />
        <input type="hidden" id="taxOnProfit" data-key="taxOnProfit" />
        <input type="hidden" id="profitForPeriod" data-key="profitForPeriod" />
      </div>

      <div class="actions">
        <button type="button" id="computeBtn">Compute</button>
        <button type="button" id="resetBtn">Reset</button>
      </div>
      <p id="calcStatus" class="status" aria-live="polite"></p>

    </form>

    <!-- RHS sliding panel for formula / details -->
    <aside id="formulaPanel" aria-hidden="true">
      <button id="closePanel" aria-label="Close">×</button>
      <div id="formulaContent">
        <h3 id="formulaTitle">Formula</h3>
        <pre id="formulaText"></pre>
        <h4>Detailed Calculation</h4>
        <pre id="formulaDetails"></pre>
        <hr />
        <div id="sliderControls" style="display:none;">
          <label><input type="checkbox" id="enableSlider" /> Enable slider to adjust value</label>
          <div id="sliderWrap" style="margin-top:8px; display:none;">
            <input type="range" id="formulaSlider" min="0" max="100" step="1" />
            <div style="margin-top:6px; display:flex; gap:8px; align-items:center;">
              <span>Adjusted value:</span>
              <output id="sliderValue">0</output>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <footer>
      <p>Ready to deploy to Vercel: drop the <code>web</code> folder into a repo and link to Vercel.</p>
    </footer>
  </div>

  <script src="/taxModel.js"></script>
  <script src="/taxEngine.js"></script>
  <script src="/web/app.js"></script>
</body>
</html>
